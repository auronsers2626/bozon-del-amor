<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buzón del Coso</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1 id="titulo">Buzón del Coso</h1>

  <div id="contenedor">
    <img id="buzon" src="buzon.png" alt="Buzón cerrado">
    
    <div id="carta" class="oculto">
      <div id="contenido-carta">
        <p>
          💌 NUEVO MENSAJE DE: EL BUZÓN DEL COSO S.A.<br><br>
          Asunto: ¡Tu corazón tiene una notificación pendiente💙<br><br>
          ¡Hola, Molsa preciosa!  
Gracias por seguir suscrita al sistema de correos del BUZÓN DEL COSO S.A., donde cada latido tiene tu nombre.
<br><br>
          Tenemos una oferta exclusiva solo para ti:  
1 abrazo para toda la vida + 2000 besos de 8 años cada uno + 1te amo sin fecha de vencimiento.  
Todo esto, enviado directamente desde el corazón de tu coso
¿Por qué recibes este mensaje?  
Porque alguien pensó en ti justo ahora.  
Porque tu sonrisa activa todos los algoritmos de mi corazón. 
Porque el coso no puede dejar de amarte, ni siquiera cuando intenta hacer otra cosa.<br><br>
          ¿Quieres cancelar esta suscripción?  
Imposible. Este amor no tiene botón de “unsubscribe”.  
Solo puedes archivarlo en tu corazón, marcarlo como favorito o responderlo con un te amo.
        </p>
        <button id="borrar">Borrar</button>
      </div>
    </div>

    <p id="mensaje"></p>
    <div id="contador"></div>
  </div>

  <script>
    const buzón = document.getElementById("buzon");
    const carta = document.getElementById("carta");
    const borrar = document.getElementById("borrar");
    const mensaje = document.getElementById("mensaje");
    const contador = document.getElementById("contador");

    const TIEMPO_ESPERA = 24 * 60 * 60 * 1000;

    function iniciarContador() {
      const ahora = Date.now();
      localStorage.setItem("siguienteCarta", ahora + TIEMPO_ESPERA);
      actualizarEstado();
    }

    function actualizarEstado() {
      const siguiente = localStorage.getItem("siguienteCarta");
      const ahora = Date.now();

      if (!siguiente || ahora >= siguiente) {
        mensaje.textContent = "¡Tienes una nueva carta en el buzón!";
        contador.textContent = "";
        buzón.src = "buzon.png";
        buzón.style.pointerEvents = "auto";
        buzón.style.opacity = "1";
        carta.classList.add("oculto");
      } else {
        mensaje.textContent = "Mensaje entregado, Gracias, Tu presencia mejora todos nuestros sistemas. Vuelve en 24 horas."
        buzón.src = "buzon.png";
        buzón.style.pointerEvents = "none";
        buzón.style.opacity = "0.6";
        carta.classList.add("oculto");
        actualizarContador(siguiente - ahora);
      }
    }

    function actualizarContador(tiempoRestante) {
      function formato(t) {
        const h = Math.floor(t / 3600);
        const m = Math.floor((t % 3600) / 60);
        const s = Math.floor(t % 60);
        return `${h}h ${m}m ${s}s`;
      }

      const intervalo = setInterval(() => {
        const siguiente = localStorage.getItem("siguienteCarta");
        const ahora = Date.now();
        const restante = Math.floor((siguiente - ahora) / 1000);

        if (restante <= 0) {
          clearInterval(intervalo);
          actualizarEstado();
        } else {
          contador.textContent = `⏳ ${formato(restante)} restantes`;
        }
      }, 1000);
    }

    buzón.addEventListener("click", () => {
      carta.classList.remove("oculto");
      buzón.style.display = "none";
    });

    borrar.addEventListener("click", () => {
      carta.classList.add("oculto");
      buzón.style.display = "block";
      buzón.src = "buzon.png";
      iniciarContador();
    });

    actualizarEstado();
  </script>
</body>
</html>
